# 顺顺网约车项目

## 项目简介
顺顺网约车是一个基于Go语言开发的现代化网约车平台，**创新性地将用户端和司机端功能合并在同一个系统中**。通过统一的API接口和灵活的角色权限管理，实现了一套代码同时支持乘客叫车和司机接单的完整业务流程，提供高效、安全、便捷的出行服务。

该项目采用微服务架构，支持用户/司机注册登录、叫车/接单、支付结算、行程管理、消息通知等全流程功能，旨在打造一个技术架构简洁、业务功能完整的网约车解决方案。

## 技术栈

### 后端
- **编程语言**: Go
- **Web框架**: 自定义API网关
- **RPC框架**: gRPC
- **数据库**: MySQL
- **缓存**: Redis
- **服务注册与发现**: Consul
- **配置管理**: Viper
- **认证**: JWT (支持用户/司机双角色认证)
- **容器化**: Docker

### 工具与中间件
- **代码生成**: Protocol Buffers
- **API测试**: K6
- **数据库迁移**: 自定义脚本
- **加密工具**: AES/RSA
- **地图服务**: 高德地图/百度地图API
- **消息推送**: 极光推送

## 项目结构

```
shunshun/
├── api/                   # API定义目录
│   └── user/              # 用户/司机统一API定义
│       └── v1/            # API版本
│           └── user.proto # Protobuf定义
├── build/                 # 构建目录
│   └── Dockerfile         # Docker构建文件
├── configs/               # 配置文件目录
│   └── config.yaml        # 主配置文件
├── internal/              # 内部代码目录
│   ├── api-gateway/       # API网关服务
│   │   ├── handler/       # 请求处理器
│   │   ├── middleware/    # 中间件
│   │   ├── request/       # 请求结构定义
│   │   ├── router/        # 路由配置
│   │   └── main.go        # 网关入口
│   ├── pkg/               # 公共包
│   │   ├── configs/       # 配置处理
│   │   ├── global/        # 全局变量
│   │   ├── initialization/# 初始化组件
│   │   ├── model/         # 数据模型
│   │   └── utils/         # 工具函数
│   ├── proto/             # Protobuf生成代码
│   └── server-user/       # 用户/司机服务 (统一服务实现)
│       ├── server/        # 服务实现
│       └── main.go        # 服务入口
├── scripts/               # 脚本目录
│   ├── k6.js              # 性能测试脚本
│   ├── migrate.sh         # 数据库迁移脚本
│   └── rebate.sql         # 返利SQL
├── .gitignore             # Git忽略文件
├── LICENSE                # 许可证
├── Makefile               # 构建脚本
└── README.md              # 项目文档
```

## 核心功能模块

### 统一认证与用户管理
- 用户/司机注册与登录 (统一入口，区分角色)
- 个人信息管理 (支持乘客和司机信息字段)
- 身份认证与授权 (JWT双角色认证)
- 密码重置与安全管理

### 订单管理 (用户/司机协同功能)
- **用户端功能**:
  - 叫车请求 (实时叫车/预约叫车)
  - 订单状态查询
  - 行程历史记录
  - 订单评价与投诉

- **司机端功能**:
  - 订单推送与抢单
  - 订单接收与拒绝
  - 行程开始/结束确认
  - 司机端订单历史

- **系统功能**:
  - 智能订单匹配算法
  - 行程实时跟踪
  - 路线规划与导航
  - 距离与时间估算

### 支付与结算系统
- 在线支付 (支持多种支付方式)
- 账单管理与明细查询
- 优惠券系统与促销活动
- 司机佣金结算
- 退款处理

### 消息通知系统
- 实时消息推送 (用户/司机双向)
- 短信验证码发送
- 系统通知与活动推送
- 行程状态变更通知

### 地图与位置服务
- 地理位置定位 (用户/司机实时位置)
- 路线规划与导航
- 距离计算
- 附近司机搜索与展示
- 热力图展示 (司机端)

### 管理后台功能
- 用户/司机管理
- 订单管理与统计
- 财务管理
- 系统配置与监控

## 双角色系统设计亮点

1. **统一API接口**: 一套API接口同时支持用户和司机角色，减少代码冗余
2. **灵活的权限控制**: 基于角色的访问控制(RBAC)，确保不同角色只能访问对应功能
3. **共享数据模型**: 用户和司机共享基础数据模型，同时扩展各自的专属字段
4. **统一的订单流程**: 从叫车到支付的完整流程，支持用户和司机两端的协同操作
5. **实时数据同步**: 确保用户和司机端的订单状态、位置信息等实时同步

## 技术架构优势

1. **微服务架构**: 服务模块化，易于扩展和维护
2. **高性能**: 基于Go语言开发，性能优异，支持高并发
3. **可扩展性**: 支持水平扩展，应对业务增长
4. **高可用性**: 服务注册与发现，确保系统稳定运行
5. **安全性**: 完善的认证授权机制，保障数据安全

## 快速开始

### 环境要求
- Go 1.18+
- MySQL 8.0+
- Redis 6.0+
- Consul 1.10+

### 安装步骤

1. **克隆项目**
```bash
git clone <项目仓库地址>
cd shunshun
```

2. **安装依赖**
```bash
go mod download
```

3. **配置文件**
修改 `configs/config.yaml` 文件，配置数据库、Redis、Consul等信息。

4. **生成Protobuf代码**
```bash
make proto
```

5. **启动服务**
```bash
# 启动API网关
make run-gateway

# 启动用户/司机统一服务
make run-user
```

## 配置说明

主要配置文件位于 `configs/config.yaml`，包含以下关键配置项：

- **server**: 服务器配置（端口、地址等）
- **mysql**: 数据库连接信息
- **redis**: Redis配置
- **consul**: 服务注册与发现配置
- **jwt**: JWT双角色认证配置
- **log**: 日志配置
- **map**: 地图服务API配置
- **push**: 消息推送配置

## 开发流程

### 代码规范
- 遵循Go语言官方代码规范
- 使用 `go fmt` 格式化代码
- 使用 `golint` 检查代码质量

### 提交规范
- 使用语义化版本控制
- 提交信息清晰明了
- 遵循Conventional Commits规范

## 部署方式

### Docker部署
```bash
docker build -t shunshun-api-gateway -f build/Dockerfile .
docker run -p 8080:8080 shunshun-api-gateway
```

### Kubernetes部署
使用项目提供的Kubernetes配置文件进行部署（需单独创建）。

## 性能测试

使用K6进行性能测试：
```bash
k6 run scripts/k6.js
```

## 许可证

该项目使用MIT许可证，详见 [LICENSE](LICENSE) 文件。

## 贡献

欢迎提交Issue和Pull Request！

## 联系方式

如有问题或建议，请通过以下方式联系：
- 邮箱：contact@shunshun.com
- 官网：www.shunshun.com
